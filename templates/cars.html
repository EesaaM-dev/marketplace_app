{% extends "base.html" %}

{% block title %}Cars{% endblock %}
{% block content%}
<!-- get all the flashed messages from the session and display the message -->
{% with messages = get_flashed_messages()%}
    {% if messages %}
    {% for message in messages %}
        <p>{{message}}</p>
        {% endfor %}
    {% endif %}
{% endwith %}
<style>

table, th,td {
    height: 50px;
    border: solid, 1px, black;
    padding-right: 20px;
    padding-left: 10px;
    margin-left: 20px;
}
.btn-group button {
    margin-right: 5px;
}

</style>
<table>
        <tr>
            <th>ID</th>
            <th>Make</th>
            <th>Model</th>
            <th>Price</th>
            <th>Mileage</th>

            <!-- actions tab only shows if user is logged in  -->
            {% if current_user.is_authenticated and action_tab == True or current_user.is_admin %}
            <th>Actions</th>
            {% endif %}

        </tr>

    <!-- for loop which iterates through the car_list and populates the table each row corrresponds to a car from the car_list -->
    {% for car in car_list %}
    <tr>
        <td>{{car.id}}</td>  
        <td>{{car.make}}</td>  
        <td>{{car.model}}</td>  
        <td>{{ "Â£{:,}".format(car.price)}}</td>  
        <td>{{ "{:,}".format(car.mileage)}}</td> 

        <!-- only display the edit and delete options if the user is logged in and listing belongs to them  -->
        <!-- ensures that the table is drawn correctly (lines for each listing) -->
        {% if current_user.is_authenticated and action_tab == True or current_user.is_admin %}
        <td>
    <!-- if the current user is logged in and user id is the same as listings user id or the user is admin show the edit and delete actions on the table -->
            {% if current_user.is_authenticated and current_user.id == car.user_id or current_user.is_admin %}
            <div class="btn-group" role="group" aria-label="edit delete">
                <form method="GET" action="{{ url_for('edit_car', car_id=car.id)}}"><button type="submit" class="btn btn-secondary" style="background-color: green;">Edit</button></form>
                <form method="POST" action="{{ url_for('delete_car', car_id=car.id)}}"><button type="submit" class="btn btn-secondary" style="background-color: red;">Delete</button></form>
            </div>
            {% endif %}
        </td>
        {% endif %}
       
        
    </tr>
   {% endfor %}

    </table>


   

{% endblock %}

